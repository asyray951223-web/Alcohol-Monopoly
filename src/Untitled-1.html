<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>é…’ç²¾å¤§å¯Œç¿ Alcohol Monopoly</title>
    <!-- å¼•å…¥ Tailwind CSS 2 (CDN) -->
    <link
      href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css"
      rel="stylesheet"
    />

    <!-- PWA è¨­å®š -->
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#111827" />

    <!-- html2canvas ç”¨æ–¼æˆªåœ– -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <link rel="stylesheet" href="style.css" />
    <style>
      /* 3D éª°å­æ¨£å¼ */
      .dice-scene {
        perspective: 600px;
        width: 200px;
        height: 200px;
        --card-bg: #ffffff;
        --accent-color: #d1d5db; /* gray-300 */
      }
      .dice-cube {
        width: 100%;
        height: 100%;
        position: relative;
        transform-style: preserve-3d;
        transition: transform 1s cubic-bezier(0.2, 0.8, 0.2, 1);
      }
      .dice-face {
        position: absolute;
        width: 200px;
        height: 200px;
        background: var(--card-bg);
        border: 4px solid var(--accent-color);
        border-radius: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 100px;
        color: #000;
        box-shadow: inset 0 0 40px rgba(0, 0, 0, 0.1);
        backface-visibility: hidden;
      }
      /* ç¢ºä¿èƒŒé¢ä¸é€æ˜ */
      .dice-face::before {
        content: "";
        position: absolute;
        inset: 0;
        background: var(--card-bg);
        border-radius: 26px;
        z-index: -1;
      }
      /* éª°å­å…­é¢å®šä½ */
      .face-1 {
        transform: rotateY(0deg) translateZ(100px);
      }
      .face-2 {
        transform: rotateY(180deg) translateZ(100px);
      }
      .face-3 {
        transform: rotateY(90deg) translateZ(100px);
      }
      .face-4 {
        transform: rotateY(-90deg) translateZ(100px);
      }
      .face-5 {
        transform: rotateX(90deg) translateZ(100px);
      }
      .face-6 {
        transform: rotateX(-90deg) translateZ(100px);
      }

      /* å®¹å™¨ç¸®æ”¾è¼”åŠ© (ç”¨æ–¼å°‡ 200px çš„éª°å­ç¸®æ”¾åˆ° UI ä¸­) */
      .dice-scale-wrapper {
        transform-origin: center center;
      }

      /* RWD éª°å­ç¸®æ”¾è¨­å®š */
      .dice-scale-main {
        transform: scale(0.3); /* æ‰‹æ©Ÿç‰ˆæ”¾å¤§è‡³ 0.3 (60px) */
      }
      @media (min-width: 768px) {
        .dice-scale-main {
          transform: scale(0.35); /* é›»è…¦ç‰ˆç¶­æŒ 0.35 (70px) */
        }
      }

      /* è§€æˆ°æ¨¡å¼æ¨£å¼ (ç”± JS åˆ‡æ› class ä½¿ç”¨) */
      .spectator-mode {
        opacity: 0.4;
        filter: grayscale(100%);
      }

      /* æµ®å‹•å‹•ç•«æ¨£å¼ (ç”¨æ–¼ç²å¾—é‡‘ç‰Œæˆ–åŠ åˆ†æ™‚) */
      .float-plus-one {
        position: fixed;
        color: #fbbf24; /* yellow-400 */
        font-weight: bold;
        pointer-events: none;
        animation: floatUp 1.5s ease-out forwards;
        z-index: 100;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
      }
      @keyframes floatUp {
        0% {
          transform: translate(-50%, 0) scale(1);
          opacity: 1;
        }
        100% {
          transform: translate(-50%, -80px) scale(1.2);
          opacity: 0;
        }
      }

      /* å½ˆçª—éœ‡å‹•ç‰¹æ•ˆ */
      .animate-shake {
        animation: shake 0.5s cubic-bezier(0.36, 0.07, 0.19, 0.97) both;
      }
      @keyframes shake {
        10%,
        90% {
          transform: scale(1) translate3d(-2px, 0, 0);
        }
        20%,
        80% {
          transform: scale(1) translate3d(4px, 0, 0);
        }
        30%,
        50%,
        70% {
          transform: scale(1) translate3d(-6px, 0, 0);
        }
        40%,
        60% {
          transform: scale(1) translate3d(6px, 0, 0);
        }
      }
    </style>
  </head>
  <body
    class="text-white h-screen flex flex-col items-center justify-center overflow-hidden bg-gray-900"
  >
    <!-- å·¦å´é¸å–®æŒ‰éˆ• (Hamburger Button) -->
    <button
      id="menu-btn"
      class="fixed top-4 left-4 z-50 p-2 bg-gray-800 rounded-full border border-gray-600 shadow-lg text-white focus:outline-none hover:bg-gray-700 transition"
    >
      <svg
        class="w-6 h-6"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M4 6h16M4 12h16M4 18h16"
        ></path>
      </svg>
    </button>

    <!-- é¸å–®é®ç½©å±¤ (Overlay) -->
    <div
      id="sidebar-overlay"
      class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden transition-opacity duration-300 opacity-0 backdrop-filter backdrop-blur-sm"
    ></div>

    <!-- å·¦å´æ»‘å‹•é¸å–® (Sidebar) -->
    <div
      id="sidebar"
      class="fixed top-0 left-0 h-full w-64 bg-gray-900 border-r border-purple-500 shadow-2xl z-50 transform -translate-x-full transition-transform duration-300 flex flex-col"
    >
      <div
        class="p-6 border-b border-gray-800 flex justify-between items-center"
      >
        <h2
          class="text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600 neon-text"
        >
          é¸å–®
        </h2>
        <button
          id="close-menu-btn"
          class="text-gray-400 hover:text-white transition"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18L18 6M6 6l12 12"
            ></path>
          </svg>
        </button>
      </div>
      <nav class="flex-1 overflow-y-auto py-4">
        <ul class="space-y-1 px-3">
          <li>
            <button
              class="menu-item w-full text-left px-4 py-3 rounded-xl hover:bg-gray-800 transition flex items-center space-x-3 text-gray-300 hover:text-white"
              data-target="home"
            >
              <span>ğŸ </span>
              <span>ä¸»é </span>
            </button>
          </li>
          <li>
            <button
              class="menu-item w-full text-left px-4 py-3 rounded-xl hover:bg-gray-800 transition flex items-center space-x-3 text-gray-300 hover:text-white"
              data-target="players"
            >
              <span>ğŸ‘¥</span>
              <span>ç©å®¶</span>
            </button>
          </li>
          <li>
            <button
              class="menu-item w-full text-left px-4 py-3 rounded-xl hover:bg-gray-800 transition flex items-center space-x-3 text-gray-300 hover:text-white"
              data-target="cards"
            >
              <span>ğŸƒ</span>
              <span>å¡ç‰Œç®¡ç†</span>
            </button>
          </li>
          <li>
            <button
              class="menu-item w-full text-left px-4 py-3 rounded-xl hover:bg-gray-800 transition flex items-center space-x-3 text-gray-300 hover:text-white"
              data-target="map"
            >
              <span>ğŸ—ºï¸</span>
              <span>åœ°åœ–ç·¨è¼¯</span>
            </button>
          </li>
          <li>
            <button
              class="menu-item w-full text-left px-4 py-3 rounded-xl hover:bg-gray-800 transition flex items-center space-x-3 text-gray-300 hover:text-white"
              data-target="leaderboard"
            >
              <span>ğŸ†</span>
              <span>æ’è¡Œæ¦œ</span>
            </button>
          </li>
          <li>
            <button
              class="menu-item w-full text-left px-4 py-3 rounded-xl hover:bg-gray-800 transition flex items-center space-x-3 text-gray-300 hover:text-white"
              data-target="history"
            >
              <span>ğŸ“œ</span>
              <span>æ­·å²ç´€éŒ„</span>
            </button>
          </li>
          <li>
            <button
              class="menu-item w-full text-left px-4 py-3 rounded-xl hover:bg-gray-800 transition flex items-center space-x-3 text-gray-300 hover:text-white"
              data-target="dice"
            >
              <span>ğŸ²</span>
              <span>éª°å­</span>
            </button>
          </li>
          <li>
            <button
              class="menu-item w-full text-left px-4 py-3 rounded-xl hover:bg-gray-800 transition flex items-center space-x-3 text-gray-300 hover:text-white"
              data-target="roulette"
            >
              <span>ğŸ”«</span>
              <span>ä¿„ç¾…æ–¯è¼ªç›¤</span>
            </button>
          </li>
          <li>
            <button
              class="menu-item w-full text-left px-4 py-3 rounded-xl hover:bg-gray-800 transition flex items-center space-x-3 text-gray-300 hover:text-white"
              data-target="timer"
            >
              <span>â±ï¸</span>
              <span>è¨ˆæ™‚å™¨</span>
            </button>
          </li>
          <li>
            <button
              class="menu-item w-full text-left px-4 py-3 rounded-xl hover:bg-gray-800 transition flex items-center space-x-3 text-gray-300 hover:text-white"
              data-target="settings"
            >
              <span>âš™ï¸</span>
              <span>è¨­å®š</span>
            </button>
          </li>
          <li>
            <button
              class="menu-item w-full text-left px-4 py-3 rounded-xl hover:bg-gray-800 transition flex items-center space-x-3 text-gray-300 hover:text-white"
              data-target="help"
            >
              <span>â„¹ï¸</span>
              <span>å¹«åŠ©èˆ‡èªªæ˜</span>
            </button>
          </li>
        </ul>
      </nav>
      <div
        class="p-4 border-t border-gray-800 text-xs text-gray-600 text-center"
      >
        Alcohol Monopoly v1.1
      </div>
    </div>

    <!-- å°è¦½é  (Landing Page) -->
    <div
      id="landing-page"
      class="fixed inset-0 z-50 bg-gray-900 flex flex-col items-center justify-center p-4 w-full h-full"
    >
      <div class="text-center animate-fade-in">
        <div class="text-4xl md:text-6xl mb-4">ğŸ»</div>
        <h1
          class="text-3xl md:text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600 neon-text mb-2"
        >
          é…’ç²¾å¤§å¯Œç¿
        </h1>
        <h2 class="text-2xl text-gray-400 tracking-widest mb-12 font-light">
          ALCOHOL MONOPOLY
        </h2>

        <button
          id="enter-game-btn"
          class="bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white text-xl font-bold py-4 px-12 rounded-full shadow-lg transform transition hover:scale-105 neon-box"
        >
          é€²å…¥é…’å±€
        </button>

        <div class="mt-12 text-gray-600 text-sm">
          <p>âš ï¸ ç†æ€§é£²é…’ï¼Œå®‰å…¨å›å®¶</p>
          <p>æœªæ»¿ 18 æ­²è«‹å‹¿é£²é…’</p>
        </div>
      </div>
    </div>

    <!-- éª°å­é é¢ (Dice Page) -->
    <div
      id="dice-container"
      class="fixed inset-0 z-30 bg-gray-900 flex flex-col items-center justify-center p-4 w-full h-full hidden"
    >
      <h2
        class="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500 neon-text mb-12"
      >
        ğŸ² æ“²éª°å­
      </h2>

      <!-- éª°å­é¡¯ç¤ºå€åŸŸ -->
      <div
        id="standalone-dice-wrapper"
        class="flex flex-wrap gap-4 mb-8 justify-center w-full max-w-4xl min-h-[10rem]"
      >
        <!-- JS å‹•æ…‹ç”Ÿæˆéª°å­ -->
      </div>

      <!-- éª°å­æ•¸é‡åˆ‡æ› -->
      <div
        class="flex items-center space-x-4 mb-8 bg-gray-800 p-2 rounded-lg border border-gray-700"
      >
        <span class="text-gray-400 text-sm font-bold ml-2">æ•¸é‡:</span>
        <button
          id="dice-count-minus"
          class="w-10 h-10 bg-gray-700 hover:bg-gray-600 rounded text-white font-bold text-xl transition"
        >
          -
        </button>
        <span
          id="dice-count-display"
          class="text-2xl font-bold w-12 text-center text-purple-400"
          >1</span
        >
        <button
          id="dice-count-plus"
          class="w-10 h-10 bg-purple-600 hover:bg-purple-500 rounded text-white font-bold text-xl transition shadow-lg"
        >
          +
        </button>
      </div>

      <button
        id="standalone-roll-btn"
        class="w-full max-w-xs bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 text-white font-bold py-4 px-8 rounded-full shadow-lg transform transition active:scale-95 mb-8 text-xl border-b-4 border-blue-800"
      >
        æ“²éª°å­
      </button>

      <div
        id="dice-total-display"
        class="text-2xl font-mono text-yellow-400 font-bold h-8 mb-4 opacity-0 transition-opacity"
      >
        ç¸½å’Œ: <span id="dice-total-value">0</span>
      </div>

      <button
        id="dice-back-btn"
        class="text-gray-400 hover:text-white flex items-center space-x-2 transition"
      >
        <span>â†©ï¸</span> <span>è¿”å›éŠæˆ²</span>
      </button>
    </div>

    <!-- ä¿„ç¾…æ–¯è¼ªç›¤ (Russian Roulette) -->
    <div
      id="roulette-container"
      class="fixed inset-0 z-30 bg-gray-900 flex flex-col items-center justify-center p-4 w-full h-full hidden"
    >
      <h2
        class="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-red-500 to-yellow-500 neon-text mb-8"
      >
        ä¿„ç¾…æ–¯è¼ªç›¤
      </h2>

      <!-- å½ˆå·¢è¦–è¦º (Cylinder) -->
      <div
        id="cylinder"
        class="relative w-64 h-64 rounded-full border-8 border-gray-700 bg-gray-800 mb-12 shadow-2xl flex items-center justify-center transition-transform duration-200"
      >
        <!-- ä¸­å¿ƒè»¸ -->
        <div
          class="absolute w-8 h-8 bg-gray-500 rounded-full z-10 shadow-inner"
        ></div>
        <!-- 6å€‹å½ˆå­” (ä½¿ç”¨ inline style æ—‹è½‰å®šä½) -->
        <div
          class="chamber absolute w-12 h-12 bg-gray-900 rounded-full border-4 border-gray-600 shadow-inner"
          style="transform: rotate(0deg) translate(0, -80px)"
        ></div>
        <div
          class="chamber absolute w-12 h-12 bg-gray-900 rounded-full border-4 border-gray-600 shadow-inner"
          style="transform: rotate(60deg) translate(0, -80px)"
        ></div>
        <div
          class="chamber absolute w-12 h-12 bg-gray-900 rounded-full border-4 border-gray-600 shadow-inner"
          style="transform: rotate(120deg) translate(0, -80px)"
        ></div>
        <div
          class="chamber absolute w-12 h-12 bg-gray-900 rounded-full border-4 border-gray-600 shadow-inner"
          style="transform: rotate(180deg) translate(0, -80px)"
        ></div>
        <div
          class="chamber absolute w-12 h-12 bg-gray-900 rounded-full border-4 border-gray-600 shadow-inner"
          style="transform: rotate(240deg) translate(0, -80px)"
        ></div>
        <div
          class="chamber absolute w-12 h-12 bg-gray-900 rounded-full border-4 border-gray-600 shadow-inner"
          style="transform: rotate(300deg) translate(0, -80px)"
        ></div>
      </div>

      <button
        id="fire-btn"
        class="w-full max-w-xs bg-gradient-to-b from-red-600 to-red-800 hover:from-red-500 hover:to-red-700 text-white font-bold py-4 px-8 rounded-full shadow-lg transform transition active:scale-95 mb-6 text-xl border-b-4 border-red-900"
      >
        é–‹æ§ (FIRE)
      </button>

      <button
        id="roulette-back-btn"
        class="text-gray-400 hover:text-white flex items-center space-x-2 transition"
      >
        <span>â†©ï¸</span> <span>è¿”å›éŠæˆ²</span>
      </button>
    </div>

    <!-- è¨ˆæ™‚å™¨ (Timer) -->
    <div
      id="timer-container"
      class="fixed inset-0 z-30 bg-gray-900 flex flex-col items-center justify-center p-4 w-full h-full hidden"
    >
      <h2
        class="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-blue-500 neon-text mb-8"
      >
        å€’æ•¸è¨ˆæ™‚å™¨
      </h2>

      <!-- æ™‚é–“é¡¯ç¤º -->
      <div
        id="timer-display"
        class="text-7xl font-mono font-bold text-white mb-8 neon-text tracking-widest"
      >
        00:00
      </div>

      <!-- å¿«é€Ÿè¨­å®šæŒ‰éˆ• -->
      <div class="grid grid-cols-4 gap-2 mb-8 w-full max-w-xs">
        <button
          class="timer-preset-btn bg-gray-800 hover:bg-gray-700 border border-gray-600 text-white py-2 rounded transition"
          data-time="10"
        >
          +10s
        </button>
        <button
          class="timer-preset-btn bg-gray-800 hover:bg-gray-700 border border-gray-600 text-white py-2 rounded transition"
          data-time="30"
        >
          +30s
        </button>
        <button
          class="timer-preset-btn bg-gray-800 hover:bg-gray-700 border border-gray-600 text-white py-2 rounded transition"
          data-time="60"
        >
          +1m
        </button>
        <button
          class="timer-preset-btn bg-gray-800 hover:bg-gray-700 border border-gray-600 text-white py-2 rounded transition"
          data-time="300"
        >
          +5m
        </button>
      </div>

      <!-- æ§åˆ¶æŒ‰éˆ• -->
      <div class="flex space-x-6 mb-10">
        <button
          id="timer-start-btn"
          class="w-24 h-24 rounded-full bg-green-600 hover:bg-green-500 text-white font-bold text-xl shadow-lg transition flex items-center justify-center border-4 border-green-800"
        >
          é–‹å§‹
        </button>
        <button
          id="timer-reset-btn"
          class="w-24 h-24 rounded-full bg-red-600 hover:bg-red-500 text-white font-bold text-xl shadow-lg transition flex items-center justify-center border-4 border-red-800"
        >
          é‡ç½®
        </button>
      </div>

      <button
        id="timer-back-btn"
        class="text-gray-400 hover:text-white flex items-center space-x-2 transition"
      >
        <span>â†©ï¸</span> <span>è¿”å›éŠæˆ²</span>
      </button>
    </div>

    <!-- ç©å®¶åˆ—è¡¨ (Players) -->
    <div
      id="players-container"
      class="fixed inset-0 z-30 bg-gray-900 flex flex-col items-center justify-center p-4 w-full h-full hidden"
    >
      <h2
        class="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-teal-400 neon-text mb-6"
      >
        ğŸ‘¥ ç©å®¶åˆ—è¡¨
      </h2>

      <div
        class="w-[90%] md:w-full max-w-md bg-gray-800 rounded-2xl border border-blue-500 shadow-2xl overflow-hidden flex-1 max-h-[70vh] flex flex-col p-4"
      >
        <!-- æ–°å¢åˆ—è¡¨æ¨™é¡Œåˆ— -->
        <div
          class="flex items-center justify-between pb-2 mb-2 border-b border-gray-700 text-gray-400 text-xs font-bold px-2"
        >
          <div class="flex-1">ç©å®¶åç¨±</div>
          <div class="flex items-center space-x-3">
            <div class="w-12 text-center">æ¯æ•¸</div>
            <div class="w-12 text-center">è§€æˆ°</div>
          </div>
        </div>
        <div
          id="players-list-content"
          class="space-y-3 overflow-y-auto custom-scrollbar flex-1"
        >
          <!-- JS å‹•æ…‹ç”Ÿæˆ -->
        </div>
      </div>

      <div class="flex space-x-6 mt-8">
        <button
          onclick="addNewPlayerInGame()"
          class="text-green-400 hover:text-white flex items-center space-x-2 transition"
          title="æ–°å¢ä¸€ä½ç©å®¶"
        >
          <span>â•</span> <span>æ–°å¢ç©å®¶</span>
        </button>
        <button
          onclick="clearAllSpectators()"
          class="text-blue-400 hover:text-white flex items-center space-x-2 transition"
          title="è®“æ‰€æœ‰ç©å®¶å›åˆ°éŠæˆ²"
        >
          <span>ğŸ‘ï¸</span> <span>å…¨éƒ¨è§£é™¤è§€æˆ°</span>
        </button>
        <button
          id="players-back-btn"
          class="text-gray-400 hover:text-white flex items-center space-x-2 transition"
        >
          <span>â†©ï¸</span> <span>è¿”å›éŠæˆ²</span>
        </button>
      </div>
    </div>

    <!-- æ’è¡Œæ¦œ (Leaderboard) -->
    <div
      id="leaderboard-container"
      class="fixed inset-0 z-30 bg-gray-900 flex flex-col items-center justify-center p-4 w-full h-full hidden"
    >
      <h2
        class="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-yellow-600 neon-text mb-6"
      >
        ğŸ† é…’é‡æ’è¡Œæ¦œ ğŸ†
      </h2>

      <div
        id="leaderboard-card"
        class="w-[90%] md:w-full max-w-md bg-gray-800 rounded-2xl border border-yellow-600 shadow-2xl overflow-hidden flex-1 max-h-[60vh] flex flex-col"
      >
        <div
          class="p-3 bg-gray-700 border-b border-gray-600 grid grid-cols-12 gap-2 text-gray-300 font-bold text-sm text-center"
        >
          <div class="col-span-2">æ’å</div>
          <div class="col-span-4 text-left pl-2">ç©å®¶</div>
          <div class="col-span-3">æ¯æ•¸</div>
          <div class="col-span-3">èª¿æ•´</div>
        </div>
        <div
          id="leaderboard-list"
          class="overflow-y-auto p-2 space-y-2 custom-scrollbar"
        >
          <!-- JS å‹•æ…‹ç”Ÿæˆ -->
        </div>
      </div>

      <div class="flex space-x-6 mt-8">
        <button
          id="leaderboard-share-btn"
          class="text-green-400 hover:text-white flex items-center space-x-2 transition"
        >
          <span>ğŸ“¸</span> <span>æˆªåœ–ä¸‹è¼‰</span>
        </button>
        <button
          id="leaderboard-back-btn"
          class="text-gray-400 hover:text-white flex items-center space-x-2 transition"
        >
          <span>â†©ï¸</span> <span>è¿”å›éŠæˆ²</span>
        </button>
      </div>
    </div>

    <!-- éŠæˆ²çµç®—ç•«é¢ (Game Over) -->
    <div
      id="game-over-container"
      class="fixed inset-0 z-50 bg-gray-900 flex flex-col items-center justify-center p-4 w-full h-full hidden"
    >
      <div class="text-4xl md:text-6xl mb-4 animate-bounce">ğŸ†</div>
      <h2
        class="text-3xl md:text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-yellow-300 to-yellow-600 neon-text mb-2"
      >
        éŠæˆ²çµæŸ
      </h2>
      <p id="game-over-reason" class="text-gray-400 mb-8 text-center">
        æœ‰äººå·²ç¶“ä¸çœäººäº‹äº†...
      </p>

      <div
        class="w-[90%] md:w-full max-w-md bg-gray-800 rounded-2xl border border-yellow-600 shadow-2xl overflow-hidden flex-1 max-h-[60vh] flex flex-col"
      >
        <div
          class="p-3 bg-gray-700 border-b border-gray-600 grid grid-cols-12 gap-2 text-gray-300 font-bold text-sm text-center"
        >
          <div class="col-span-2">æ’å</div>
          <div class="col-span-6 text-left pl-2">ç©å®¶</div>
          <div class="col-span-4">ç¸½æ¯æ•¸</div>
        </div>
        <div
          id="game-over-list"
          class="overflow-y-auto p-2 space-y-2 custom-scrollbar"
        >
          <!-- JS å‹•æ…‹ç”Ÿæˆ -->
        </div>
      </div>

      <div class="flex space-x-4 mt-8">
        <button
          onclick="continueGame()"
          class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-xl transition shadow-lg border border-gray-500"
        >
          ç¹¼çºŒéŠæˆ² (+5æ¯)
        </button>
        <button
          onclick="restartGame()"
          class="bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-bold py-3 px-6 rounded-xl shadow-lg transform transition hover:scale-105"
        >
          é‡æ–°é–‹å§‹
        </button>
      </div>
    </div>

    <!-- å¡ç‰Œç®¡ç† (Cards) -->
    <div
      id="cards-container"
      class="fixed inset-0 z-30 bg-gray-900 flex flex-col items-center justify-center p-4 w-full h-full hidden"
    >
      <h2
        class="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-pink-400 to-purple-500 neon-text mb-6"
      >
        ğŸƒ å¡ç‰Œç®¡ç†
      </h2>

      <div
        class="w-[90%] md:w-full max-w-md bg-gray-800 rounded-2xl border border-gray-600 shadow-2xl overflow-hidden flex-1 max-h-[70vh] flex flex-col p-4"
      >
        <div class="flex space-x-2 mb-2">
          <button
            id="cards-tab-chance"
            class="flex-1 py-2 rounded-t-lg bg-gray-700 text-gray-400 hover:bg-gray-600 font-bold transition"
          >
            æ©Ÿæœƒå¡ç‰Œ
          </button>
          <button
            id="cards-tab-fate"
            class="flex-1 py-2 rounded-t-lg bg-gray-900 text-pink-500 border-t-2 border-pink-500 font-bold transition"
          >
            å‘½é‹å¡ç‰Œ
          </button>
        </div>

        <div
          class="bg-gray-900 border border-gray-700 rounded-b-lg p-2 flex-1 flex flex-col min-h-0"
        >
          <div
            id="cards-list"
            class="flex-1 overflow-y-auto space-y-2 mb-2 custom-scrollbar pr-1"
          >
            <!-- å¡ç‰Œåˆ—è¡¨ JS å‹•æ…‹ç”Ÿæˆ -->
          </div>
          <div class="flex space-x-2 mt-2">
            <input
              id="new-card-input"
              type="text"
              placeholder="è¼¸å…¥æ–°å…§å®¹..."
              class="flex-1 bg-gray-800 text-white rounded px-3 py-2 border border-gray-600 focus:outline-none focus:border-pink-500"
            />
            <button
              id="add-card-btn"
              class="bg-pink-600 hover:bg-pink-500 text-white px-4 py-2 rounded font-bold"
            >
              +
            </button>
          </div>
          <div class="mt-2 pt-2 border-t border-gray-700">
            <button
              id="reset-cards-btn"
              class="w-full text-xs text-gray-500 hover:text-gray-300 transition py-1"
            >
              â†º é‡ç½®ç‚ºé è¨­å¡ç‰Œ
            </button>
          </div>
        </div>
      </div>

      <button
        id="cards-back-btn"
        class="mt-8 text-gray-400 hover:text-white flex items-center space-x-2 transition"
      >
        <span>â†©ï¸</span> <span>è¿”å›éŠæˆ²</span>
      </button>
    </div>

    <!-- åœ°åœ–ç·¨è¼¯å™¨ (Map Editor) -->
    <div
      id="map-editor-container"
      class="fixed inset-0 z-30 bg-gray-900 flex flex-col items-center justify-center p-4 w-full h-full hidden"
    >
      <h2
        class="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-blue-500 neon-text mb-6"
      >
        ğŸ—ºï¸ åœ°åœ–ç·¨è¼¯å™¨
      </h2>

      <div
        class="w-[90%] md:w-full max-w-md bg-gray-800 rounded-2xl border border-gray-600 shadow-2xl overflow-hidden flex-1 max-h-[70vh] flex flex-col p-4"
      >
        <div
          id="map-editor-panel"
          class="bg-gray-900 border border-gray-700 rounded-lg p-3 flex-1 flex flex-col min-h-0"
        >
          <!-- åœ°åœ–å°ºå¯¸è¨­å®š -->
          <div
            class="grid grid-cols-2 gap-3 mb-3 pb-3 border-b border-gray-700"
          >
            <div>
              <label class="text-xs text-gray-400 block mb-1"
                >åœ°åœ–å¯¬åº¦ (æ ¼æ•¸)</label
              >
              <input
                id="map-width-input"
                type="number"
                min="3"
                max="20"
                value="10"
                class="w-full bg-gray-800 text-white rounded px-3 py-2 border border-gray-600 focus:outline-none focus:border-blue-500 text-center font-bold"
              />
            </div>
            <div>
              <label class="text-xs text-gray-400 block mb-1"
                >åœ°åœ–é«˜åº¦ (æ ¼æ•¸)</label
              >
              <input
                id="map-height-input"
                type="number"
                min="3"
                max="14"
                value="6"
                class="w-full bg-gray-800 text-white rounded px-3 py-2 border border-gray-600 focus:outline-none focus:border-blue-500 text-center font-bold"
              />
            </div>
          </div>

          <!-- éš¨æ©Ÿç”ŸæˆæŒ‰éˆ• -->
          <button
            id="random-map-btn"
            class="w-full bg-purple-700 hover:bg-purple-600 text-white font-bold py-2 rounded-lg mb-4 shadow transition flex items-center justify-center space-x-2"
          >
            <span>ğŸ²</span> <span>éš¨æ©Ÿç”Ÿæˆåœ°åœ–å…§å®¹</span>
          </button>

          <div class="mb-3">
            <label class="text-xs text-gray-400 block mb-1"
              >é¸æ“‡è¦ç·¨è¼¯çš„æ ¼å­</label
            >
            <select
              id="map-tile-select"
              class="w-full bg-gray-800 text-white rounded px-3 py-2 border border-gray-600 focus:outline-none focus:border-blue-500"
            >
              <!-- JS å‹•æ…‹ç”Ÿæˆé¸é … -->
            </select>
          </div>

          <div class="space-y-3 overflow-y-auto custom-scrollbar pr-1 flex-1">
            <div>
              <label class="text-xs text-gray-400 block mb-1"
                >åç¨± (é¡¯ç¤ºåœ¨æ ¼å­ä¸Š)</label
              >
              <input
                id="map-tile-text"
                type="text"
                class="w-full bg-gray-800 text-white rounded px-3 py-2 border border-gray-600 focus:outline-none focus:border-blue-500"
              />
            </div>

            <div>
              <label class="text-xs text-gray-400 block mb-1"
                >é¡å‹ (æ±ºå®šé¡è‰²èˆ‡åœ–ç¤º)</label
              >
              <select
                id="map-tile-type"
                class="w-full bg-gray-800 text-white rounded px-3 py-2 border border-gray-600 focus:outline-none focus:border-blue-500"
              >
                <option value="start">ğŸ èµ·é» (Start)</option>
                <option value="normal">ğŸ² æ™®é€š (Normal)</option>
                <option value="chance">â“ æ©Ÿæœƒ (Chance)</option>
                <option value="fate">ğŸ”® å‘½é‹ (Fate)</option>
                <option value="jail">ğŸ›‘ æš«åœ/å»æ‰€ (Jail)</option>
                <option value="punish">ğŸº æ‡²ç½° (Punish)</option>
              </select>
            </div>

            <div>
              <label class="text-xs text-gray-400 block mb-1"
                >æè¿° (å½ˆçª—å…§å®¹)</label
              >
              <textarea
                id="map-tile-desc"
                rows="3"
                class="w-full bg-gray-800 text-white rounded px-3 py-2 border border-gray-600 focus:outline-none focus:border-blue-500"
              ></textarea>
            </div>
          </div>

          <button
            id="save-tile-btn"
            class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-2 rounded-lg mt-3 shadow-lg transition"
          >
            å„²å­˜ä¿®æ”¹
          </button>
        </div>
      </div>

      <button
        id="map-editor-back-btn"
        class="mt-8 text-gray-400 hover:text-white flex items-center space-x-2 transition"
      >
        <span>â†©ï¸</span> <span>è¿”å›éŠæˆ²</span>
      </button>
    </div>

    <!-- è¨­å®šé é¢ (Settings) -->
    <div
      id="settings-container"
      class="fixed inset-0 z-30 bg-gray-900 flex flex-col items-center justify-center p-4 w-full h-full hidden"
    >
      <h2
        class="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-gray-200 to-gray-400 neon-text mb-6"
      >
        âš™ï¸ éŠæˆ²è¨­å®š
      </h2>

      <div
        class="w-[90%] md:w-full max-w-md bg-gray-800 rounded-2xl border border-gray-600 shadow-2xl overflow-hidden flex-1 max-h-[70vh] flex flex-col p-4"
      >
        <!-- éŸ³æ•ˆè¨­å®š -->
        <div class="mb-6 p-3 bg-gray-700 rounded-lg">
          <div class="flex justify-between items-center mb-4">
            <span class="text-lg font-bold text-gray-200"
              >ğŸ”Š éŠæˆ²éŸ³æ•ˆ (SFX)</span
            >
            <button
              id="sound-toggle-btn"
              class="w-14 h-8 rounded-full bg-green-500 relative transition-colors duration-300 focus:outline-none"
            >
              <div
                id="sound-toggle-circle"
                class="w-6 h-6 bg-white rounded-full absolute top-1 left-7 transition-all duration-300 shadow-md"
              ></div>
            </button>
          </div>
          <div
            class="flex justify-between items-center border-t border-gray-600 pt-4"
          >
            <span class="text-lg font-bold text-gray-200"
              >ğŸµ èƒŒæ™¯éŸ³æ¨‚ (BGM)</span
            >
            <button
              id="bgm-toggle-btn"
              class="w-14 h-8 rounded-full bg-gray-500 relative transition-colors duration-300 focus:outline-none"
            >
              <div
                id="bgm-toggle-circle"
                class="w-6 h-6 bg-white rounded-full absolute top-1 left-1 transition-all duration-300 shadow-md"
              ></div>
            </button>
          </div>
        </div>

        <!-- çµæŸæ¢ä»¶è¨­å®š (New) -->
        <div
          class="flex justify-between items-center mb-6 p-3 bg-gray-700 rounded-lg"
        >
          <span class="text-lg font-bold text-gray-200"
            >ğŸ çµæŸæ¢ä»¶ (æ¯æ•¸)</span
          >
          <div class="flex items-center space-x-3">
            <button
              id="setting-limit-minus"
              class="w-8 h-8 bg-gray-600 hover:bg-gray-500 rounded text-white font-bold transition"
            >
              -
            </button>
            <span
              id="setting-limit-display"
              class="text-xl font-bold text-pink-400 w-8 text-center"
              >20</span
            >
            <button
              id="setting-limit-plus"
              class="w-8 h-8 bg-pink-600 hover:bg-pink-500 rounded text-white font-bold shadow transition"
            >
              +
            </button>
          </div>
        </div>

        <!-- éª°å­æ•¸é‡è¨­å®š (New) -->
        <div
          class="flex justify-between items-center mb-6 p-3 bg-gray-700 rounded-lg"
        >
          <span class="text-lg font-bold text-gray-200">ğŸ² ä¸»é éª°å­æ•¸é‡</span>
          <div class="flex items-center space-x-3">
            <button
              id="setting-dice-minus"
              class="w-8 h-8 bg-gray-600 hover:bg-gray-500 rounded text-white font-bold transition"
            >
              -
            </button>
            <span
              id="setting-dice-display"
              class="text-xl font-bold text-purple-400 w-6 text-center"
              >1</span
            >
            <button
              id="setting-dice-plus"
              class="w-8 h-8 bg-purple-600 hover:bg-purple-500 rounded text-white font-bold shadow transition"
            >
              +
            </button>
          </div>
        </div>

        <!-- åœ°åœ–æ–¹å‘è¨­å®š (New) -->
        <div
          class="flex justify-between items-center mb-6 p-3 bg-gray-700 rounded-lg"
        >
          <span class="text-lg font-bold text-gray-200">ğŸ§­ åœ°åœ–æ–¹å‘</span>
          <div class="flex space-x-2">
            <button
              id="setting-orientation-landscape"
              class="px-3 py-1 rounded bg-gray-600 text-gray-300 hover:bg-gray-500 font-bold transition text-sm"
            >
              æ©«å‘
            </button>
            <button
              id="setting-orientation-portrait"
              class="px-3 py-1 rounded bg-gray-600 text-gray-300 hover:bg-gray-500 font-bold transition text-sm"
            >
              ç›´å‘
            </button>
          </div>
        </div>

        <!-- å‚™ä»½èˆ‡é‚„åŸ (New) -->
        <div class="mt-6 pt-4 border-t border-gray-700">
          <h3 class="text-gray-400 text-sm font-bold mb-2">ğŸ’¾ å‚™ä»½èˆ‡é‚„åŸ</h3>
          <div class="flex space-x-2">
            <button
              id="export-btn"
              class="flex-1 bg-blue-700 hover:bg-blue-600 text-white font-bold py-2 rounded-lg transition flex items-center justify-center space-x-2"
            >
              <span>ğŸ“¤</span> <span>åŒ¯å‡ºè¨­å®š</span>
            </button>
            <button
              id="import-btn"
              class="flex-1 bg-green-700 hover:bg-green-600 text-white font-bold py-2 rounded-lg transition flex items-center justify-center space-x-2"
            >
              <span>ğŸ“¥</span> <span>åŒ¯å…¥è¨­å®š</span>
            </button>
            <input
              type="file"
              id="import-file-input"
              class="hidden"
              accept=".json"
            />
          </div>
        </div>

        <!-- é‡ç½®éŠæˆ² -->
        <div class="mt-6 pt-4 border-t border-gray-700">
          <button
            id="full-reset-btn"
            class="w-full bg-red-900 hover:bg-red-800 text-red-200 border border-red-700 font-bold py-3 rounded-xl transition flex items-center justify-center space-x-2"
          >
            <span>âš ï¸</span> <span>é‡ç½®æ‰€æœ‰éŠæˆ²é€²åº¦</span>
          </button>
        </div>
      </div>

      <button
        id="settings-back-btn"
        class="mt-8 text-gray-400 hover:text-white flex items-center space-x-2 transition"
      >
        <span>â†©ï¸</span> <span>è¿”å›éŠæˆ²</span>
      </button>
    </div>

    <!-- è¨­å®šé é¢ (Setup Screen) -->
    <div
      id="setup-screen"
      class="fixed inset-0 z-50 bg-gray-900 flex flex-col items-center justify-center p-4 w-full h-full hidden"
    >
      <div
        class="w-[90%] md:w-full max-w-md bg-gray-800 rounded-2xl p-6 border border-purple-500 shadow-2xl neon-box max-h-[90vh] overflow-y-auto custom-scrollbar"
      >
        <h1
          class="text-3xl font-black text-center text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600 neon-text mb-6"
        >
          ç©å®¶è¨­å®š
        </h1>

        <div class="mb-2 text-gray-400 text-sm text-center">
          è«‹è¼¸å…¥ç©å®¶åç¨± (2-12äºº)
        </div>

        <!-- ç©å®¶è¼¸å…¥åˆ—è¡¨ -->
        <div
          id="player-inputs"
          class="space-y-3 mb-6 max-h-60 overflow-y-auto px-1"
        >
          <!-- JS æœƒå‹•æ…‹ç”¢ç”Ÿè¼¸å…¥æ¡† -->
        </div>

        <!-- è‡ªè¨‚æ‡²ç½° (æ–°å¢) -->
        <div class="mb-6 border-t border-gray-700 pt-4">
          <div
            class="text-gray-400 text-xs mb-2 flex justify-between items-center"
          >
            <span>è‡ªè¨‚æ‡²ç½° (å°‡åŠ å…¥å‘½é‹å¡)</span>
            <span id="custom-card-count" class="text-pink-500 font-bold"
              >0</span
            >
          </div>
          <div class="flex space-x-2 mb-2">
            <input
              id="setup-card-input"
              type="text"
              placeholder="è¼¸å…¥æ‡²ç½°å…§å®¹ (ä¾‹å¦‚: ä¼åœ°æŒºèº«20ä¸‹)"
              class="flex-1 bg-gray-700 text-white rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-pink-500 border border-gray-600"
            />
            <button
              id="setup-add-card-btn"
              class="bg-gray-700 hover:bg-gray-600 text-pink-500 font-bold px-3 py-2 rounded-lg border border-gray-600 transition"
            >
              +
            </button>
          </div>
          <div
            id="setup-cards-container"
            class="flex flex-wrap gap-2 max-h-24 overflow-y-auto custom-scrollbar"
          >
            <!-- JS å‹•æ…‹ç”Ÿæˆæ¨™ç±¤ -->
          </div>
        </div>

        <!-- æ§åˆ¶æŒ‰éˆ• -->
        <div class="flex space-x-2 mb-6">
          <button
            id="add-player-btn"
            class="flex-1 bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition border border-gray-600"
          >
            + æ–°å¢ç©å®¶
          </button>
          <button
            id="remove-player-btn"
            class="w-12 bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition border border-gray-600 flex items-center justify-center"
          >
            -
          </button>
        </div>

        <button
          id="start-game-btn"
          class="w-full bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-bold py-3 px-4 rounded-xl shadow-lg transform transition hover:scale-105"
        >
          é–‹å§‹éŠæˆ²
        </button>
      </div>
    </div>

    <!-- éŠæˆ²ä¸»å®¹å™¨ -->
    <div
      id="game-container"
      class="fixed inset-0 z-0 p-1 flex items-center justify-center hidden"
    >
      <!-- åœ°åœ–å€åŸŸï¼šGrid (JS å‹•æ…‹ç”Ÿæˆ) -->
      <div id="game-grid" class="grid gap-0.5 w-full max-h-full mx-auto">
        <!-- === ä¸­å¿ƒæ§åˆ¶å€ (Center Panel) === -->
        <div
          id="center-panel"
          class="col-span-8 row-span-4 bg-gray-900 rounded-xl border-2 border-purple-500 neon-box relative z-0 overflow-hidden"
        >
          <div class="flex h-full w-full">
            <!-- Left: Title & Info -->
            <div
              id="center-left-panel"
              class="hidden md:flex flex-1 flex flex-col justify-center items-center p-2 md:p-4 border-r border-gray-800 bg-gray-800 bg-opacity-30 cursor-pointer hover:bg-gray-700 hover:bg-opacity-40 transition relative overflow-hidden"
              onclick="resetCenterInfo()"
            >
              <!-- Default View (Title) -->
              <div
                id="center-default-view"
                class="text-center transition-opacity duration-300"
              >
                <div class="text-xl md:text-5xl mb-2 animate-bounce">ğŸ»</div>
                <h1
                  class="text-sm md:text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600 neon-text leading-tight"
                >
                  é…’ç²¾<br />å¤§å¯Œç¿
                </h1>
                <div
                  class="mt-2 text-[8px] md:text-[10px] text-gray-500 tracking-[0.2em] uppercase"
                >
                  Alcohol Monopoly
                </div>
              </div>

              <!-- Tile Info View (Hidden by default) -->
              <div
                id="center-tile-view"
                class="absolute inset-0 flex flex-col justify-center items-center p-4 text-center hidden opacity-0 transition-opacity duration-300 bg-gray-900 bg-opacity-95 w-full h-full z-10"
              >
                <div
                  id="center-tile-icon"
                  class="text-3xl md:text-7xl mb-3 filter drop-shadow-lg transform transition-transform hover:scale-110"
                ></div>
                <h2
                  id="center-tile-title"
                  class="text-lg md:text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600 neon-text mb-2"
                ></h2>
                <div
                  class="w-12 h-1 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full mb-3 opacity-80"
                ></div>
                <p
                  id="center-tile-desc"
                  class="text-sm md:text-base text-gray-200 leading-relaxed max-w-[90%] font-medium"
                ></p>
                <div
                  class="mt-4 text-[10px] text-gray-500 uppercase tracking-widest opacity-60"
                >
                  é»æ“Šé—œé–‰
                </div>
              </div>
            </div>

            <!-- Center: Action Area -->
            <div
              class="flex-[2] flex flex-col items-center justify-center p-2 relative"
            >
              <!-- Mobile Player Info (New: æ‰‹æ©Ÿç‰ˆå°ˆç”¨ç©å®¶è³‡è¨Š) -->
              <div class="md:hidden w-full text-center mb-2">
                <div
                  id="mobile-player-name"
                  class="text-xl font-bold text-white"
                ></div>
                <div class="text-yellow-400 font-bold text-sm">
                  ğŸº <span id="mobile-player-drinks">0</span> æ¯
                </div>
                <div
                  id="mobile-player-shields"
                  class="hidden text-gray-400 text-xs font-bold mt-1 cursor-pointer hover:text-yellow-300 animate-pulse"
                >
                  ğŸ›¡ï¸ <span id="mobile-player-shield-count">0</span> (é»æ“Šä½¿ç”¨)
                </div>
              </div>

              <!-- éª°å­é¡¯ç¤ºå€ -->
              <div
                id="main-dice-wrapper"
                class="flex flex-wrap justify-center gap-4 mb-4 min-h-[5rem] items-center transition-all"
              >
                <!-- JS å‹•æ…‹ç”Ÿæˆéª°å­ -->
              </div>

              <!-- æ§åˆ¶æŒ‰éˆ• -->
              <button
                id="roll-btn"
                class="group relative w-40 md:w-56 overflow-hidden rounded-full bg-gradient-to-r from-pink-500 to-purple-600 p-0.5 shadow-lg transition-all hover:scale-105 active:scale-95"
              >
                <span
                  class="relative block rounded-full bg-gray-900 px-4 py-3 text-white transition-all group-hover:bg-opacity-0 font-bold text-sm md:text-xl"
                >
                  ğŸ² æ“²éª°å­
                </span>
              </button>
            </div>

            <!-- Right: Current Player -->
            <div
              class="hidden md:flex flex-1 flex flex-col justify-center items-center p-2 md:p-4 border-l border-gray-800 bg-gray-800 bg-opacity-30"
            >
              <div
                class="text-[10px] md:text-xs text-gray-400 mb-2 uppercase tracking-wider font-bold"
              >
                Current Turn
              </div>
              <div
                id="current-player-name"
                class="text-sm md:text-2xl font-bold text-white text-center break-words w-full px-2"
              >
                æº–å‚™é–‹å§‹
              </div>
              <!-- ç´¯ç©æ¯æ•¸é¡¯ç¤º -->
              <div
                class="mt-2 text-yellow-400 font-mono font-bold text-sm md:text-base"
              >
                ğŸº <span id="current-player-drinks">0</span> æ¯
              </div>
              <!-- å…æ­»é‡‘ç‰Œé¡¯ç¤º (æœ‰é‡‘ç‰Œæ™‚é¡¯ç¤º) -->
              <div
                id="current-player-shields"
                class="mt-1 text-gray-400 text-xs font-bold cursor-pointer hover:text-yellow-300 transition hidden select-none animate-pulse"
                title="é»æ“Šä½¿ç”¨å…æ­»é‡‘ç‰ŒæŠµéŠ·ä¸€æ¯"
              >
                ğŸ›¡ï¸ <span id="current-player-shield-count">0</span> (é»æ“Šä½¿ç”¨)
              </div>
              <!-- è£é£¾æ€§é€²åº¦æ¢ -->
              <div
                class="mt-4 w-12 md:w-16 h-1.5 rounded-full bg-gray-700 overflow-hidden"
              >
                <div
                  class="h-full bg-gradient-to-r from-yellow-400 to-orange-500 w-full animate-pulse"
                ></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ç©å®¶æ£‹å­å®¹å™¨ (çµ•å°å®šä½è¦†è“‹åœ¨åœ°åœ–ä¸Š) -->
      <div
        id="players-layer"
        class="absolute inset-0 pointer-events-none w-full h-full"
      >
        <!-- ç¯„ä¾‹æ£‹å­: ä¹‹å¾Œæœƒç”¨ JS å‹•æ…‹ç”Ÿæˆä¸¦è¨ˆç®—ä½ç½® -->
        <!-- <div class="player-token absolute w-4 h-4 bg-red-500 rounded-full border-2 border-white shadow-md" style="top: 2%; left: 2%;"></div> -->
      </div>
    </div>

    <!-- æ­·å²ç´€éŒ„ (History) -->
    <div
      id="history-container"
      class="fixed inset-0 z-30 bg-gray-900 flex flex-col items-center justify-center p-4 w-full h-full hidden"
    >
      <h2
        class="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-indigo-500 neon-text mb-6"
      >
        ğŸ“œ æ­·å²ç´€éŒ„
      </h2>

      <div
        class="w-[90%] md:w-full max-w-md bg-gray-800 rounded-2xl border border-gray-600 shadow-2xl overflow-hidden flex-1 max-h-[70vh] flex flex-col p-4"
      >
        <div
          id="history-log"
          class="space-y-2 text-sm overflow-y-auto pr-1 custom-scrollbar flex-1"
        >
          <div class="text-gray-500 italic text-center py-2">å°šç„¡ç´€éŒ„...</div>
        </div>
      </div>

      <button
        id="history-back-btn"
        class="mt-8 text-gray-400 hover:text-white flex items-center space-x-2 transition"
      >
        <span>â†©ï¸</span> <span>è¿”å›éŠæˆ²</span>
      </button>
    </div>

    <!-- å½ˆçª— Modal (éš±è—ç‹€æ…‹) -->
    <div
      id="event-modal"
      class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-90 hidden opacity-0 transition-opacity duration-300"
    >
      <!-- ç¿»è½‰å¡ç‰‡å®¹å™¨ -->
      <div
        id="modal-card-container"
        class="relative w-full h-full md:w-full md:max-w-sm md:h-96 perspective-1000 cursor-pointer transform scale-95 transition-transform duration-300 p-4 md:p-0"
      >
        <div
          id="modal-flip-inner"
          class="relative w-full h-full transition-transform duration-700 transform-style-3d"
        >
          <!-- æ­£é¢ (å¡èƒŒ - é»æ“Šå‰é¡¯ç¤º) -->
          <div
            class="absolute inset-0 backface-hidden bg-gray-800 rounded-2xl border-4 border-gray-600 flex flex-col items-center justify-center shadow-2xl z-20"
            id="modal-front-face"
          >
            <div id="modal-front-icon" class="text-8xl mb-6 animate-bounce">
              â“
            </div>
            <h3
              id="modal-front-title"
              class="text-4xl font-black text-white tracking-widest"
            >
              æ©Ÿæœƒ
            </h3>
            <p class="text-gray-400 mt-6 text-sm animate-pulse">ğŸ‘† é»æ“Šç¿»é–‹</p>
          </div>

          <!-- èƒŒé¢ (å…§å®¹ - ç¿»é–‹å¾Œé¡¯ç¤º) -->
          <div
            class="absolute inset-0 backface-hidden rotate-y-180 bg-gray-800 rounded-2xl border-4 border-pink-500 p-4 md:p-6 flex flex-col justify-between shadow-2xl z-10"
          >
            <div
              class="text-center mt-2 md:mt-4 flex-1 flex flex-col items-center w-full"
              style="min-height: 0"
            >
              <h3
                id="modal-back-title"
                class="text-2xl md:text-3xl font-bold text-pink-500 mb-2 md:mb-4 flex-shrink-0 px-2"
              >
                ...
              </h3>
              <div
                class="w-16 h-1 bg-gradient-to-r from-purple-500 to-pink-500 mx-auto mb-2 md:mb-4 rounded flex-shrink-0"
              ></div>
              <p
                id="modal-back-desc"
                class="text-white text-base md:text-xl leading-relaxed font-medium overflow-y-auto custom-scrollbar w-full px-2 whitespace-pre-line flex-1"
              >
                ...
              </p>
            </div>
            <div class="w-full space-y-2">
              <button
                id="close-modal-btn"
                class="w-full bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-xl transition shadow-lg"
              >
                çŸ¥é“äº† (é—œé–‰)
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- å¹«åŠ©èˆ‡èªªæ˜ (Help) -->
    <div
      id="help-container"
      class="fixed inset-0 z-30 bg-gray-900 flex flex-col items-center justify-center p-4 w-full h-full hidden"
    >
      <h2
        class="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-cyan-500 neon-text mb-6"
      >
        â„¹ï¸ å¹«åŠ©èˆ‡èªªæ˜
      </h2>

      <div
        class="w-[90%] md:w-full max-w-md bg-gray-800 rounded-2xl border border-blue-500 shadow-2xl overflow-hidden flex-1 max-h-[70vh] flex flex-col p-4"
      >
        <div
          class="overflow-y-auto custom-scrollbar flex-1 space-y-4 text-gray-300 text-sm leading-relaxed pr-2"
        >
          <!-- ç‰ˆæœ¬è³‡è¨Š -->
          <div class="bg-gray-900 p-3 rounded-lg border border-gray-700">
            <h3 class="text-white font-bold text-lg mb-1">
              ğŸº é…’ç²¾å¤§å¯Œç¿ v1.2
            </h3>
            <p class="text-gray-400 text-xs">å°ˆç‚ºæ´¾å°è¨­è¨ˆçš„ç¶²é ç‰ˆé…’æ¡ŒéŠæˆ²ã€‚</p>
          </div>

          <!-- è©³ç´°åŠŸèƒ½ä»‹ç´¹ -->
          <div class="space-y-4">
            <div>
              <h3
                class="text-yellow-400 font-bold text-base mb-2 border-b border-gray-700 pb-1"
              >
                ğŸ›¡ï¸ å…æ­»é‡‘ç‰Œç³»çµ±
              </h3>
              <ul class="list-disc list-inside space-y-1 text-gray-400 text-xs">
                <li>
                  <strong class="text-gray-200">ç²å¾—æ–¹å¼ï¼š</strong
                  >ç¶“éã€Œèµ·é»ã€æˆ–æŠ½å–ç‰¹å®šã€Œæ©Ÿæœƒå¡ã€ã€‚
                </li>
                <li>
                  <strong class="text-gray-200">è‡ªå‹•æŠµéŠ·ï¼š</strong
                  >ç•¶é‡åˆ°æ‡²ç½°æ™‚ï¼Œè‹¥æŒæœ‰é‡‘ç‰Œå¯é¸æ“‡æŠµéŠ·ã€‚
                </li>
                <li>
                  <strong class="text-gray-200">ä¸»å‹•ä½¿ç”¨ï¼š</strong
                  >åœ¨ä¸»ç•«é¢é»æ“Šè‡ªå·±çš„é‡‘ç‰Œåœ–ç¤ºï¼Œå¯ä¸»å‹•æŠµéŠ· 1 æ¯é…’ã€‚
                </li>
                <li>
                  <strong class="text-gray-200">è´ˆé€ï¼š</strong
                  >åœ¨ã€Œç©å®¶åˆ—è¡¨ã€ä¸­å¯æ‰‹å‹•çµ¦äºˆå…¶ä»–ç©å®¶é‡‘ç‰Œã€‚
                </li>
              </ul>
            </div>

            <div>
              <h3
                class="text-blue-400 font-bold text-base mb-2 border-b border-gray-700 pb-1"
              >
                ğŸ‘¥ ç©å®¶ç®¡ç†èˆ‡è§€æˆ°
              </h3>
              <ul class="list-disc list-inside space-y-1 text-gray-400 text-xs">
                <li>
                  <strong class="text-gray-200">è§€æˆ°æ¨¡å¼ï¼š</strong
                  >åœ¨ç©å®¶åˆ—è¡¨é»æ“Šã€ŒğŸ‘ï¸ã€æˆ–å‹¾é¸è§€æˆ°ï¼Œè©²ç©å®¶å°‡è·³éæ“²éª°ä½†ä¿ç•™åœ¨å ´ä¸Šã€‚
                </li>
                <li>
                  <strong class="text-gray-200">æš«åœ/å»æ‰€ï¼š</strong
                  >é»æ“Šã€Œæš«åœã€å¯æš«æ™‚è·³éä¸€å›åˆã€‚
                </li>
                <li>
                  <strong class="text-gray-200">åˆªé™¤ç©å®¶ï¼š</strong
                  >åœ¨åˆ—è¡¨ã€Œé•·æŒ‰ã€ç©å®¶é ­åƒå¯å°‡å…¶ç§»é™¤ã€‚
                </li>
                <li>
                  <strong class="text-gray-200">æ–°å¢ç©å®¶ï¼š</strong
                  >éŠæˆ²é€”ä¸­å¯éš¨æ™‚æ–°å¢åŠ å…¥æˆ°å±€ã€‚
                </li>
              </ul>
            </div>

            <div>
              <h3
                class="text-pink-400 font-bold text-base mb-2 border-b border-gray-700 pb-1"
              >
                ğŸƒ å¡ç‰Œèˆ‡åœ°åœ–è‡ªè¨‚
              </h3>
              <ul class="list-disc list-inside space-y-1 text-gray-400 text-xs">
                <li>
                  <strong class="text-gray-200">å¡ç‰Œç®¡ç†ï¼š</strong
                  >å¯æ–°å¢ã€ç·¨è¼¯ã€åˆªé™¤ã€Œæ©Ÿæœƒ/å‘½é‹ã€å¡ç‰Œå…§å®¹ï¼Œæˆ–ä¸€éµé‡ç½®ç‚ºé è¨­å€¼ã€‚
                </li>
                <li>
                  <strong class="text-gray-200">åœ°åœ–ç·¨è¼¯ï¼š</strong
                  >æ”¯æ´ç›´å‘/æ©«å‘åˆ‡æ›ï¼Œå¯è‡ªè¨‚æ ¼å­é¡å‹èˆ‡æ–‡å­—ï¼Œæˆ–ä½¿ç”¨ã€Œéš¨æ©Ÿç”Ÿæˆã€ã€‚
                </li>
              </ul>
            </div>

            <div>
              <h3
                class="text-green-400 font-bold text-base mb-2 border-b border-gray-700 pb-1"
              >
                ğŸ’¾ ç³»çµ±èˆ‡å­˜æª”
              </h3>
              <ul class="list-disc list-inside space-y-1 text-gray-400 text-xs">
                <li>
                  <strong class="text-gray-200">è‡ªå‹•å­˜æª”ï¼š</strong
                  >æ‰€æœ‰é€²åº¦çš†æœƒè‡ªå‹•å„²å­˜åœ¨ç€è¦½å™¨ä¸­ã€‚
                </li>
                <li>
                  <strong class="text-gray-200">å‚™ä»½é‚„åŸï¼š</strong
                  >åœ¨è¨­å®šé é¢å¯ã€ŒåŒ¯å‡ºã€è¨­å®šæª”(JSON)åˆ†äº«çµ¦æœ‹å‹ï¼Œæˆ–ã€ŒåŒ¯å…¥ã€é€²åº¦ã€‚
                </li>
                <li>
                  <strong class="text-gray-200">éŠæˆ²çµç®—ï¼š</strong
                  >ç•¶æœ‰äººé”åˆ°è¨­å®šçš„æ¯æ•¸ä¸Šé™(é è¨­20æ¯)æ™‚ï¼Œè§¸ç™¼çµç®—ç•«é¢ã€‚
                </li>
              </ul>
            </div>

            <div>
              <h3
                class="text-purple-400 font-bold text-base mb-2 border-b border-gray-700 pb-1"
              >
                ğŸ® å…¶ä»–æ“ä½œ
              </h3>
              <ul class="list-disc list-inside space-y-1 text-gray-400 text-xs">
                <li>
                  <strong class="text-gray-200">å¿«æ·éµï¼š</strong>é›»è…¦ç‰ˆæŒ‰
                  <kbd class="bg-gray-700 px-1 rounded border border-gray-600"
                    >Space</kbd
                  >
                  å¯æ“²éª°å­ã€‚
                </li>
                <li>
                  <strong class="text-gray-200">æ’è¡Œæ¦œæˆªåœ–ï¼š</strong
                  >åœ¨æ’è¡Œæ¦œé é¢é»æ“Šã€ŒğŸ“¸ã€å¯ä¸‹è¼‰æˆ°ç¸¾æˆªåœ–ã€‚
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <button
        id="help-back-btn"
        class="mt-8 text-gray-400 hover:text-white flex items-center space-x-2 transition"
      >
        <span>â†©ï¸</span> <span>è¿”å›éŠæˆ²</span>
      </button>
    </div>

    <!-- è…³æœ¬å€åŸŸ -->
    <script src="data.js"></script>
    <script src="script.js"></script>

    <!-- è¨»å†Š PWA Service Worker -->
    <script>
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker
            .register("sw.js")
            .then((reg) => console.log("SW registered!", reg))
            .catch((err) => console.log("SW failed", err));
        });
      }
    </script>
  </body>
</html>
